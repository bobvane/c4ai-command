<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>C4AI Command（CohereLabs/c4ai-command）</title>
  <style>
    /* 现代简洁样式，便于直接部署 */
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa4b2;
      --accent:#6ee7b7;
      --glass: rgba(255,255,255,0.03);
      --radius:12px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071020 0%, #071224 100%);color:#e6eef6}
    .wrap{max-width:980px;margin:36px auto;padding:28px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:16px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
    header{display:flex;gap:16px;align-items:center}
    .logo{
      width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,#12263b,#0b2b3a);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent);font-size:18px;
      box-shadow:0 4px 18px rgba(8,14,22,0.6);
    }
    h1{margin:0;font-size:20px}
    p.lead{margin:6px 0 18px;color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 4px 18px rgba(2,6,23,0.5)}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    textarea{width:100%;min-height:160px;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:var(--glass);color:inherit;resize:vertical;font-size:14px}
    .controls{display:flex;gap:8px;margin-top:10px;align-items:center}
    .btn{background:linear-gradient(90deg,#0ea5a0,#06b6d4);border:none;padding:10px 14px;border-radius:10px;color:#042029;cursor:pointer;font-weight:600}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .small{padding:8px 10px;font-size:13px}
    .meta{font-size:13px;color:var(--muted);margin-top:8px}
    .output{white-space:pre-wrap;font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#04101a;padding:14px;border-radius:8px;min-height:120px;color:#d8f3e6}
    .example-list{display:flex;flex-direction:column;gap:10px}
    .example{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;font-size:13px;cursor:pointer;border:1px solid transparent}
    .example:hover{border-color:rgba(255,255,255,0.04)}
    footer{margin-top:18px;color:var(--muted);font-size:13px}
    .row{display:flex;gap:8px;align-items:center}
    .select, input[type="text"]{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit;font-size:13px}
    .status{font-size:13px;color:var(--muted);margin-left:auto}
    .spinner{width:18px;height:18px;border-radius:50%;border:3px solid rgba(255,255,255,0.08);border-top-color:var(--accent);animation:spin 1s linear infinite;display:inline-block;vertical-align:middle}
    @keyframes spin{to{transform:rotate(360deg)}}
    .link{color:var(--accent);text-decoration:none}
    .note{font-size:12px;color:var(--muted);margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap" role="main">
    <header>
      <div class="logo">C4A</div>
      <div>
        <h1>C4AI Command（CohereLabs / c4ai-command）</h1>
        <p class="lead">Hugging Face Space 的主要交互（输入提示 → 发送到模型 → 显示输出）。实际调用需要替换 API Key 与模型 endpoint。页面自带 mock 模式方便离线测试。</p>
      </div>
    </header>

    <div style="height:18px"></div>

    <div class="grid">
      <div>
        <div class="card">
          <label for="prompt">Prompt（输入指令 / 提示）</label>
          <textarea id="prompt" placeholder="在此输入你的指令或提示，例如：帮我写一段 200 字的产品介绍，面向企业用户。"></textarea>

          <div class="controls">
            <button id="run" class="btn">运行（Run）</button>
            <button id="clear" class="btn secondary small">清空</button>

            <div style="margin-left:auto" class="row">
              <label style="margin:0 8px 0 0">模式</label>
              <select id="mode" class="select">
                <option value="mock">Mock（离线演示）</option>
                <option value="hf">Hugging Face Inference API</option>
              </select>
            </div>
          </div>

          <div class="meta">
            <div style="display:flex;align-items:center;gap:8px">
              <div>模型 endpoint: <code id="endpoint">CohereLabs/c4ai-command</code></div>
              <div style="margin-left:auto" class="status" id="status">未调用</div>
            </div>
            <div class="note">
              使用 Hugging Face Inference API 时，需要在下方填入你的 API Key（Bearer token）。如果你使用的是 Space 的后端（非公开 API），可能无法直接用本页调用 —— 在这种情况下请用 Space 自带 UI 或自行部署后端。
            </div>
          </div>

          <div style="height:12px"></div>

          <label for="hfkey">Hugging Face API Key（可选）：</label>
          <input id="hfkey" placeholder="填入 HF API key 可直接调用模型（Bearer token）" style="width:100%" />

          <div style="height:12px"></div>

          <label>参数（可选）</label>
          <div style="display:flex;gap:8px">
            <input id="max_tokens" class="select" type="text" placeholder="max_tokens (默认 256)" />
            <input id="temperature" class="select" type="text" placeholder="temperature (0.0 - 1.2)" />
          </div>

          <div style="height:14px"></div>

          <label>输出</label>
          <div class="output" id="output">等待运行…</div>

          <div style="height:12px"></div>

          <div class="row" style="justify-content:flex-end">
            <button id="copyOutput" class="btn secondary small">复制输出</button>
            <button id="downloadBtn" class="btn small" style="margin-left:8px">下载结果（txt）</button>
          </div>
        </div>

        <div style="height:14px"></div>

        <div class="card">
          <label>示例与快速提示（点击填充到输入框）</label>
          <div class="example-list" id="examples">
            <div class="example" data-prompt="给我写一段面向企业用户的 200 字产品文案，语气专业。">写企业产品文案（200 字）</div>
            <div class="example" data-prompt="将下面的句子改写为更礼貌的邮件开头：尊敬的张先生，我想...">改写为礼貌邮件开头</div>
            <div class="example" data-prompt="根据以下需求生成测试用例：用户能注册、登录并重置密码。">生成测试用例</div>
            <div class="example" data-prompt="将下面的技术段落翻译为英文并保持专业术语：...">翻译技术段落（中→英）</div>
          </div>
        </div>

      </div>

      <aside>
        <div class="card">
          <label>页面信息</label>
          <p style="margin:8px 0;color:var(--muted);font-size:13px">
            静态复制： <strong>C4AI Command（CohereLabs / c4ai-command）</strong><br>
            来源：Hugging Face Space（UI 仅模仿）。本文件不会自动抓取 Space 上的动态文件或脚本。
          </p>

          <div style="height:10px"></div>

          <label>快速配置</label>
          <ol style="color:var(--muted);font-size:13px">
            <li>若要直接调用模型，请选择模式 → Hugging Face Inference API，并在上方填入你的 HF API Key。</li>
            <li>如果你有自建后端，请把 <code>sendToHfInference()</code> 中的 endpoint 替换为你的服务地址。</li>
            <li>如需将页面部署至静态站点（Netlify / Vercel 等），把此单文件上传即可。</li>
          </ol>

          <div style="height:10px"></div>

          <label>注意</label>
          <p class="note">本页面为静态复刻，仅用于本地测试与展示。若需要完全复制 Space 的实时交互（例如文件上传、后端模型管理、GPU 实时推理），必须复刻或接入原始 Space 的后端服务。</p>
        </div>

        <div style="height:12px"></div>

        <div class="card">
          <label>常见问题</label>
          <p style="color:var(--muted);font-size:13px;margin:8px 0">
            Q：为什么调用失败？<br>
            A：请检查 API Key、endpoint 是否正确；或确认模型是否对 public API 可用。若 Space 使用私有后端或限定访问，本静态页面无法绕开这些限制。
          </p>

          <p style="color:var(--muted);font-size:13px"><strong>安全提示：</strong>不要在公共仓库中明文保存你的 HF API Key。</p>
        </div>
      </aside>
    </div>

    <footer>
      <div style="display:flex;align-items:center;gap:12px">
        <div>静态页面生成于本地 — 如需集成更多功能（文件上传、token 管理、模型选择），我可以继续帮你扩展。</div>
        <a class="link" href="https://huggingface.co/spaces/CohereLabs/c4ai-command" target="_blank" rel="noopener">原始 Space 页面（Hugging Face）</a>
      </div>
    </footer>
  </div>

  <script>
    // ========== 配置区 ==========
    // 默认模型 endpoint（仅作为提示）
    const DEFAULT_MODEL = "CohereLabs/c4ai-command";

    // ========== UI 元素 ==========
    const promptEl = document.getElementById('prompt');
    const runBtn = document.getElementById('run');
    const clearBtn = document.getElementById('clear');
    const outputEl = document.getElementById('output');
    const modeEl = document.getElementById('mode');
    const hfKeyEl = document.getElementById('hfkey');
    const endpointEl = document.getElementById('endpoint');
    const statusEl = document.getElementById('status');
    const examples = document.getElementById('examples');
    const copyBtn = document.getElementById('copyOutput');
    const downloadBtn = document.getElementById('downloadBtn');

    endpointEl.textContent = DEFAULT_MODEL;

    // 点击示例填充
    examples.addEventListener('click', (ev) => {
      const row = ev.target.closest('.example');
      if (!row) return;
      promptEl.value = row.dataset.prompt || '';
      promptEl.focus();
    });

    clearBtn.addEventListener('click', () => {
      promptEl.value = '';
      outputEl.textContent = '等待运行…';
    });

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(outputEl.textContent || '');
        alert('已复制输出到剪贴板');
      } catch (e) {
        alert('复制失败：' + e?.message);
      }
    });

    downloadBtn.addEventListener('click', () => {
      const blob = new Blob([outputEl.textContent || ''], {type:'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'c4ai-command-output.txt';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    // ========== 主逻辑：运行（支持 mock 与 HF Inference API） ==========
    runBtn.addEventListener('click', async () => {
      const prompt = promptEl.value.trim();
      if (!prompt) {
        alert('请输入 prompt 再运行。');
        return;
      }

      // 更新 UI
      statusEl.innerHTML = '<span class="spinner" aria-hidden="true"></span> 正在运行';
      runBtn.disabled = true;
      runBtn.textContent = '运行中…';

      try {
        const mode = modeEl.value;
        if (mode === 'mock') {
          // 简单离线 mock：稍作延迟后返回示例文本
          const mock = await mockGenerate(prompt);
          outputEl.textContent = mock;
          statusEl.textContent = '完成（mock）';
        } else if (mode === 'hf') {
          const key = hfKeyEl.value.trim();
          if (!key) {
            alert('选择 Hugging Face 模式时需提供 API Key（请在上方输入）。');
            statusEl.textContent = '中止：无 API Key';
            runBtn.disabled = false;
            runBtn.textContent = '运行（Run）';
            return;
          }
          // 读取参数
          const maxTokens = parseInt(document.getElementById('max_tokens').value) || 256;
          const temperature = parseFloat(document.getElementById('temperature').value);
          const params = {};
          if (!Number.isNaN(maxTokens)) params.max_new_tokens = maxTokens;
          if (!Number.isNaN(temperature)) params.temperature = temperature;

          try {
            const respText = await sendToHfInference(DEFAULT_MODEL, key, prompt, params);
            outputEl.textContent = respText;
            statusEl.textContent = '完成（Hugging Face）';
          } catch (err) {
            outputEl.textContent = '调用失败：' + (err?.message || String(err));
            statusEl.textContent = '调用失败';
          }
        } else {
          outputEl.textContent = '未知模式';
          statusEl.textContent = '错误';
        }
      } finally {
        runBtn.disabled = false;
        runBtn.textContent = '运行（Run）';
      }
    });

    // ========== Mock 生成器（离线演示，用于测试 UI） ==========
    async function mockGenerate(prompt) {
      await sleep(600 + Math.random()*400);
      // 简单模仿：根据 prompt 生成一个结构化回答
      const header = '=== Mock 输出（仅作界面演示） ===\\n';
      const summary = `提示摘要：${prompt.slice(0, 120)}${prompt.length>120 ? '…' : ''}\\n\\n`;
      const body = `建议回复（示例）：
- 这是一段自动生成的示例文本，用于演示界面与下载/复制等功能。
- 若要调用真实模型，请切换到 "Hugging Face Inference API" 模式并填写你的 API Key。
`;
      return header + summary + body;
    }

    // ========== 发送到 Hugging Face Inference API ==========
    // 注意：Hugging Face 的 Inference API 接受不同格式的请求，下面是通用的示例调用：
    // POST https://api-inference.huggingface.co/models/{model}
    // body: { "inputs": "...", "parameters": {...} }
    // Authorization: Bearer <HF_API_KEY>
    async function sendToHfInference(model, apiKey, prompt, parameters={}) {
      const url = `https://api-inference.huggingface.co/models/${encodeURIComponent(model)}`;
      const body = { inputs: prompt };
      if (parameters && Object.keys(parameters).length) body.parameters = parameters;

      // 如果模型返回流式数据或特殊格式，需要按模型文档解析；这里简化为普通 JSON/文本返回：
      const res = await fetch(url, {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + apiKey,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(body)
      });

      if (!res.ok) {
        const txt = await res.text();
        throw new Error(`${res.status} ${res.statusText} — ${txt}`);
      }

      // 推断返回格式：可能为 JSON（数组或对象），也可能为纯文本
      const contentType = res.headers.get('content-type') || '';
      if (contentType.includes('application/json')) {
        const data = await res.json();
        // 常见返回：[{generated_text: "..."}, ...] 或 {error: "..."} 或字符串
        if (Array.isArray(data)) {
          // 拼接所有 generated_text 或字符串字段
          return data.map(it => (it.generated_text ?? (typeof it === 'string' ? it : JSON.stringify(it)))).join('\\n\\n');
        } else if (data.generated_text) {
          return data.generated_text;
        } else {
          return JSON.stringify(data, null, 2);
        }
      } else {
        // 纯文本
        return await res.text();
      }
    }

    // ========== 工具函数 ==========
    function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

    // ========== 额外：允许通过 Ctrl+Enter 运行 ==========
    promptEl.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        runBtn.click();
      }
    });

    // 自动填充一个起始示例
    if (!promptEl.value) promptEl.value = '写一个 150 字的中文产品简介，面向企业用户，强调可靠性与安全性。';

  </script>
</body>
</html>
